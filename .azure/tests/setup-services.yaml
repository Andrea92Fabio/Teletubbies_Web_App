steps:
- script: |
    sudo apt-get update && sudo apt-get install -y docker-compose jq mysql-client
  displayName: 'Install dependencies'

- script: |
    docker-compose down -v
    docker-compose up --build -d

    echo "Waiting for frontend..."
    until curl -s -o /dev/null -w '%{http_code}' $(FRONTEND_URL_E2E) | grep -q '200'; do
      echo "$(date '+%Y-%m-%d %H:%M:%S') - Frontend not ready, retrying..."
      sleep 2
    done
    echo "Frontend is ready!"

    echo "Waiting for backend..."
    until curl -s -o /dev/null -w '%{http_code}' $(BACKEND_URL) | grep -q '200'; do
      echo "$(date '+%Y-%m-%d %H:%M:%S') - Backend not ready, retrying..."
      sleep 2
    done
    echo "Backend is ready!"
  displayName: 'Start docker compose and wait for services'
